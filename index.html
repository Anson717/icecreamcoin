<!DOCTYPE html>
<html lang="zh-TW">
<!-- Head 部分保持不變 -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>雪糕計算器</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>
    <style>
        /* 前面的樣式保持不變 */
        body {
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #ffffff;
            font-family: Arial, sans-serif;
            transition: all 0.3s ease;
        }

        body.dark-mode {
            background: #1a1a1a;
            color: white;
        }

        .container {
            display: flex;
            gap: 50px;
            padding: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .profile {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: #f0f0f0;
            border: 3px solid #000;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s ease;
            transform-origin: center center;
            will-change: transform;
            transform: rotate(0deg);
        }

        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            pointer-events: none;
        }

        .dark-mode .avatar {
            border-color: #fff;
        }

        .avatar:hover {
            transform: scale(1.05);
        }

        .button-group {
            display: flex;
            gap: 10px;
        }

        .button {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            background: #000;
            color: white;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .dark-mode .button {
            background: #fff;
            color: #000;
        }

        .button:hover {
            transform: scale(1.1);
        }

        .coin-count {
            font-size: 24px;
            font-weight: bold;
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: #000;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dark-mode .theme-toggle {
            background: #fff;
            color: #000;
        }

        .footer {
            position: fixed;
            bottom: 10px;
            font-size: 12px;
            opacity: 0.7;
        }

        @media (max-width: 600px) {
            .container {
                gap: 20px;
            }
        }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="toggleTheme()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="5"/>
            <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
        </svg>
    </button>

    <div class="container">
        <div class="profile">
            <div class="avatar" id="avatar1">
                <img src="lydia.jpg" alt="Lydia">
            </div>
            <div class="button-group">
                <button class="button" onclick="decreaseCoin(1)">-</button>
                <button class="button" onclick="addCoin(1)">+</button>
            </div>
            <div class="coin-count" id="count1">0</div>
        </div>

        <div class="profile">
            <div class="avatar" id="avatar2">
                <img src="anson.jpg" alt="Anson">
            </div>
            <div class="button-group">
                <button class="button" onclick="decreaseCoin(2)">-</button>
                <button class="button" onclick="addCoin(2)">+</button>
            </div>
            <div class="coin-count" id="count2">0</div>
        </div>
    </div>

    <div class="footer"></div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB8pd-kD1rL6LgClG9nCKHC7xB-axKNCbM",
            authDomain: "icecream-bcfeb.firebaseapp.com",
            databaseURL: "https://icecream-bcfeb-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "icecream-bcfeb",
            storageBucket: "icecream-bcfeb.firebasestorage.app",
            messagingSenderId: "13831467325",
            appId: "1:13831467325:web:b2c169a2a83775e4c31554",
            measurementId: "G-YN1CVMM5CM"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const coinsRef = database.ref('coins');

        let coins = {
            1: 0,
            2: 0
        };

        // Listen for changes in Firebase
        coinsRef.on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) {
                coins = data;
                updateDisplay();
            }
        });

        // Update Firebase
        function updateFirebase() {
            coinsRef.set(coins);
        }

        // Add coin with Firebase sync
        function addCoin(player) {
            coins[player]++;
            updateDisplay();
            updateFirebase();

            anime({
                targets: `#count${player}`,
                scale: [1, 1.2, 1],
                duration: 300,
                easing: 'easeInOutQuad'
            });
        }

        // Decrease coin with Firebase sync
        function decreaseCoin(player) {
            if (coins[player] > 0) {
                coins[player]--;
                updateDisplay();
                updateFirebase();

                anime({
                    targets: `#count${player}`,
                    scale: [1, 0.8, 1],
                    duration: 300,
                    easing: 'easeInOutQuad'
                });
            }
        }

        // Update display
        function updateDisplay() {
            document.getElementById('count1').textContent = coins[1];
            document.getElementById('count2').textContent = coins[2];
        }

        // Toggle theme
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
        }

        // Initialize theme
        if (localStorage.getItem('darkMode') === 'true') {
            document.body.classList.add('dark-mode');
        }

        // 改進的旋轉動畫
        document.querySelectorAll('.avatar').forEach(avatar => {
            let isAnimating = false;
            
            avatar.addEventListener('click', function() {
                if (isAnimating) return;
                
                isAnimating = true;
                
                anime({
                    targets: this,
                    rotate: '360deg',
                    duration: 1000,
                    easing: 'cubicBezier(.5, .05, .1, .3)',
                    complete: function(anim) {
                        // 重置旋轉角度
                        avatar.style.transform = 'rotate(0deg)';
                        isAnimating = false;
                    }
                });
            });
        });

        // Initialize data from Firebase
        coinsRef.once('value').then((snapshot) => {
            const data = snapshot.val();
            if (data) {
                coins = data;
                updateDisplay();
            }
        });
    </script>
</body>
</html>